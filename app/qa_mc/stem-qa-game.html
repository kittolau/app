<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STEM Q&A Game</title>
    <style>
    html {
      box-sizing: border-box;
      font-size: 16px;
    }
    *, *:before, *:after {
      box-sizing: inherit;
    }
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      margin-top: 40px;
      padding: 6vw 4vw;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      max-width: 420px;
      width: 95vw;
      min-width: 0;
    }
    .description {
      font-size: 1.1em;
      margin-bottom: 24px;
      color: #333;
      text-align: center;
    }
    .question {
      font-size: 1.2em;
      margin-bottom: 20px;
      color: #222;
      text-align: center;
    }
    .answers {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }
    .answer-btn {
      padding: 14px 8px;
      border: none;
      border-radius: 6px;
      background: #e0e0e0;
      color: #222;
      font-size: 1.05em;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      width: 100%;
      max-width: 100%;
      word-break: break-word;
    }
    .answer-btn.correct {
      background: #4caf50;
      color: #fff;
    }
    .answer-btn.wrong {
      background: #f44336;
      color: #fff;
    }
    .next-btn, .restart-btn, .retry-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #1976d2;
      color: #fff;
      font-size: 1em;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.2s;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      margin-bottom: 0.5em;
    }
    .retry-btn {
      background: #ffa726;
      color: #fff;
    }
    .next-btn:disabled {
      background: #90caf9;
      cursor: not-allowed;
    }
    .hint {
      font-size: 1em;
      text-align: center;
      margin-bottom: 10px;
      padding: 0 4px;
      word-break: break-word;
    }
    @media (max-width: 600px) {
      html {
        font-size: 15px;
      }
      .container {
        margin-top: 16px;
        padding: 5vw 2vw;
        max-width: 99vw;
        border-radius: 8px;
      }
      .answer-btn, .next-btn, .restart-btn, .retry-btn {
        font-size: 1em;
        padding: 12px 6px;
      }
      .description, .question, .hint {
        font-size: 1em;
      }
    }
    @media (max-width: 400px) {
      html {
        font-size: 13px;
      }
      .container {
        padding: 2vw 1vw;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="startScreen" style="display:none;"></div>
    <div class="description" id="description"></div>
    <div id="result" style="display:none;"></div>
    <canvas id="confetti-canvas" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1000;pointer-events:none;"></canvas>
    <div class="question" id="question"></div>
    <div class="score" id="score" style="text-align:center; color:#1976d2; font-weight:bold; margin-bottom:10px;"></div>
    <div class="answers" id="answers"></div>
    <div class="hint" id="hint" style="display:none; color:#d84315; margin-bottom:10px;"></div>
    <button class="retry-btn" id="retryBtn" style="display:none; background:#ffa726; color:#fff;">Retry</button>
    <button class="next-btn" id="nextBtn" style="display:none;">Next Question</button>
    <button class="restart-btn" id="restartBtn" style="display:none;">Restart Game</button>
  </div>
  <script>
    let questions = [];
    let description = '';
    let currentQuestion = 0;
    let answered = false;
    let retries = 0;
    let totalScore = 0;
    let startTime = 0;
    let finishedTime = 0;
    let gameStarted = false;

  const startScreenEl = document.getElementById('startScreen');
  const descriptionEl = document.getElementById('description');
  const resultEl = document.getElementById('result');
  const questionEl = document.getElementById('question');
  const answersEl = document.getElementById('answers');
  const scoreEl = document.getElementById('score');
  const nextBtn = document.getElementById('nextBtn');
  const restartBtn = document.getElementById('restartBtn');
  const hintEl = document.getElementById('hint');
  const retryBtn = document.getElementById('retryBtn');

    fetch('stem-qa-data.json')
      .then(response => response.json())
      .then(data => {
        questions = data.questions;
        description = data.description;
        descriptionEl.textContent = description;
        showStartScreen();
      });

    function showStartScreen() {
      gameStarted = false;
      // Hide all game UI
      descriptionEl.style.display = '';
      resultEl.style.display = 'none';
      questionEl.style.display = 'none';
      scoreEl.style.display = 'none';
      answersEl.style.display = 'none';
      hintEl.style.display = 'none';
      nextBtn.style.display = 'none';
      retryBtn.style.display = 'none';
      restartBtn.style.display = 'none';
      // Show start screen
      startScreenEl.innerHTML = `
        <div style="text-align:center; padding: 32px 0 18px 0; max-width: 350px; margin: 0 auto;">
          <div style="font-size:2em; color:#1976d2; font-weight:bold; margin-bottom:10px;">Are you ready?</div>
          <div style="font-size:1.1em; margin-bottom:18px;">You will be answering <b>${questions.length}</b> questions.</div>
          <button class="restart-btn" id="startGameBtn" style="margin-top:10px;">Start Game</button>
        </div>
      `;
      startScreenEl.style.display = '';
      document.getElementById('startGameBtn').onclick = () => {
        startScreenEl.style.display = 'none';
        descriptionEl.style.display = '';
        gameStarted = true;
        resetGame();
      };
    }

    function showQuestion() {
      if (!gameStarted) return;
      answered = false;
      nextBtn.style.display = 'none';
      restartBtn.style.display = 'none';
      hintEl.style.display = 'none';
      retryBtn.style.display = 'none';
      resultEl.style.display = 'none';
      questionEl.style.display = '';
      scoreEl.style.display = '';
      answersEl.style.display = '';
      const q = questions[currentQuestion];
      questionEl.textContent = q.question;
      scoreEl.textContent = `Score for this question: ${q.score ?? 0}`;
      answersEl.innerHTML = '';
      q.answers.forEach((ans, idx) => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = ans;
        btn.onclick = () => selectAnswer(idx, btn);
        answersEl.appendChild(btn);
      });
    }

    function selectAnswer(idx, btn) {
      if (answered) return;
      answered = true;
      const q = questions[currentQuestion];
      const btns = answersEl.querySelectorAll('button');
      if (idx === q.correct) {
        btns.forEach((b, i) => {
          if (i === q.correct) {
            b.classList.add('correct');
          }
          b.disabled = true;
        });
        hintEl.textContent = (q.hints && q.hints[idx]) ? q.hints[idx] : '';
        hintEl.style.display = q.hints && q.hints[idx] ? 'block' : 'none';
        retryBtn.style.display = 'none';
        totalScore += q.score ?? 0;
        if (currentQuestion < questions.length - 1) {
          nextBtn.style.display = 'inline-block';
        } else {
          finishedTime = Math.floor((Date.now() - startTime) / 1000);
          setTimeout(() => {
            showResultStat();
          }, 400);
        }
      } else {
        btns.forEach((b, i) => {
          if (i === idx) {
            b.classList.add('wrong');
          }
          b.disabled = true;
        });
        hintEl.textContent = (q.hints && q.hints[idx]) ? q.hints[idx] : 'Try again!';
        hintEl.style.display = 'block';
        retryBtn.style.display = 'inline-block';
        retries++;
      }
    }

    retryBtn.onclick = () => {
      showQuestion();
    };

    nextBtn.onclick = () => {
      currentQuestion++;
      showQuestion();
    };

    restartBtn.onclick = () => {
      resetGame();
    };

    function resetGame() {
      currentQuestion = 0;
      retries = 0;
      totalScore = 0;
      finishedTime = 0;
      startTime = Date.now();
      resultEl.style.display = 'none';
      showQuestion();
    }

    function showResultStat() {
      // Hide question UI
      questionEl.style.display = 'none';
      scoreEl.style.display = 'none';
      answersEl.style.display = 'none';
      hintEl.style.display = 'none';
      nextBtn.style.display = 'none';
      retryBtn.style.display = 'none';
      // Show result
      resultEl.innerHTML = `
        <div style="text-align:center; padding: 24px 0 18px 0; max-width: 350px; margin: 0 auto;">
          <div style="font-size:2.2em; margin-bottom:10px; color:#43a047; font-weight:bold; letter-spacing:1px;">
            <span style="vertical-align:middle;">ï¿½</span> You Win!
          </div>
          <div style="background:linear-gradient(90deg,#e3f2fd,#fff,#e8f5e9);border-radius:12px;padding:18px 10px 10px 10px;box-shadow:0 2px 12px rgba(33,150,243,0.08);margin-bottom:18px;">
            <div style="font-size:1.25em; color:#1976d2; margin-bottom:8px;">Total Score: <b>${totalScore}</b></div>
            <div style="font-size:1.1em; color:#f57c00; margin-bottom:8px;">Retries: <b>${retries}</b></div>
            <div style="font-size:1.1em; color:#388e3c; margin-bottom:8px;">Time: <b>${finishedTime}s</b></div>
          </div>
          <button class="restart-btn" onclick="resetGame()" style="margin-top:10px;">Restart Game</button>
        </div>
      `;
      resultEl.style.display = '';
      restartBtn.style.display = 'none';
      launchConfetti();
    }

    // Confetti effect
    function launchConfetti() {
      const canvas = document.getElementById('confetti-canvas');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.style.display = 'block';
      const ctx = canvas.getContext('2d');
      const confettiCount = 120;
      const confetti = [];
      const colors = ['#1976d2','#43a047','#fbc02d','#e53935','#8e24aa','#f57c00','#00bcd4','#cddc39'];
      for (let i = 0; i < confettiCount; i++) {
        confetti.push({
          x: Math.random() * canvas.width,
          y: Math.random() * -canvas.height,
          r: 6 + Math.random() * 8,
          d: 2 + Math.random() * 2,
          color: colors[Math.floor(Math.random()*colors.length)],
          tilt: Math.random() * 10 - 10,
          tiltAngle: 0,
          tiltAngleIncremental: (Math.random() * 0.07) + 0.05
        });
      }
      let angle = 0;
      let frame = 0;
      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        angle += 0.01;
        for (let i = 0; i < confetti.length; i++) {
          let c = confetti[i];
          c.tiltAngle += c.tiltAngleIncremental;
          c.y += (Math.cos(angle + c.d) + 1 + c.d/2);
          c.x += Math.sin(angle);
          c.tilt = Math.sin(c.tiltAngle) * 15;
          ctx.beginPath();
          ctx.lineWidth = c.r;
          ctx.strokeStyle = c.color;
          ctx.moveTo(c.x + c.tilt + c.r/3, c.y);
          ctx.lineTo(c.x + c.tilt, c.y + c.tilt + 10);
          ctx.stroke();
        }
      }
      function animate() {
        draw();
        frame++;
        if (frame < 120) {
          requestAnimationFrame(animate);
        } else {
          canvas.style.display = 'none';
        }
      }
      animate();
    }
  </script>
</body>
</html>
